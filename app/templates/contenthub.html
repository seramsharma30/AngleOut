<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SEO Suite - Content Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .sidebar {
      transition: all 0.3s ease;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div class="h-screen flex overflow-hidden">
    <!-- Sidebar -->
    <div class="sidebar bg-white w-64 border-r border-gray-200 flex flex-col">
      <div class="flex items-center justify-between p-4 border-b border-gray-200">
        <div class="flex items-center">
          <span class="text-lg font-medium text-gray-800">Angle Out</span>
        </div>
        <button class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-bars"></i>
        </button>
          </div>
      <div class="flex-1 overflow-y-auto">
        <nav class="p-2">
          <div class="mb-4">
            <a href="/dashboard"
              class="group flex items-center my-1 px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-blue-50 hover:text-blue-700">
              <i class="fas fa-home mr-3 text-gray-500 group-hover:text-blue-700"></i>
              Dashboard
            </a>
            <a href="/contenthub"
              class="group flex items-center my-1 px-3 py-2 text-sm font-medium rounded-md bg-blue-50 text-blue-700">
              <i class="fas fa-file-alt mr-3 text-blue-600"></i>
              Content Hub
            </a>
            <a href="/ranktracker"
              class="group flex items-center my-1 px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-blue-50 hover:text-blue-700">
              <i class="fas fa-chart-line mr-3 text-gray-500 group-hover:text-blue-700"></i>
              Rank Tracker
            </a>
            <a href="/monthlyreport"
              class="group flex items-center my-1 px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-blue-50 hover:text-blue-700">
              <i class="fas fa-calendar-alt mr-3 text-gray-500 group-hover:text-blue-700"></i>
              Monthly Report
            </a>
            <a href="/contentdecay"
              class="group flex items-center my-1 px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-blue-50 hover:text-blue-700">
              <i class="fas fa-chart-line mr-3 text-gray-500 group-hover:text-blue-700"></i>
              Content Decay
            </a>
            <a href="/keywordvault"
              class="group flex items-center my-1 px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-blue-50 hover:text-blue-700">
              <i class="fas fa-key mr-3 text-gray-500 group-hover:text-blue-700"></i>
              KEYWORD VAULT
            </a>
            <a href="/schema_generator"
              class="group flex items-center my-1 px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-blue-50 hover:text-blue-700">
              <i class="fas fa-tools mr-3 text-gray-500 group-hover:text-blue-700"></i>
              Tools
            </a>
          </div>
          </nav>
        </div>
      <div class="p-4 border-t border-gray-200">
        <div class="flex items-center">
            <img src="{{ profile_pic }}" alt="User" class="h-8 w-8 rounded-full mr-2">
            <div>
                <div class="text-sm font-medium text-gray-800">{{ user_name }}</div>
                <div class="text-xs text-gray-500">{{ user_email}}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <div class="flex-1 flex flex-col">
      <!-- Top navigation -->
      <header class="bg-white border-b border-gray-200">
        <div class="flex items-center justify-end px-6 py-3">
          <div class="flex items-center space-x-4 mr-2">
            <button class="text-gray-500 hover:text-gray-700">
              <i class="fas fa-question-circle"></i>
            </button>
            <button class="text-gray-500 hover:text-gray-700">
              <i class="fas fa-cog"></i>
            </button>
            <button class="text-gray-500 hover:text-gray-700">
              <i class="fas fa-bell"></i>
            </button>
            <a href="/signout" class="text-gray-500 hover:text-gray-700">
              <i class="fas fa-sign-out-alt"></i>
            </a>
          </div>
        </div>
      </header>

      <main class="flex-1 overflow-y-auto">
        <div class="py-6">
          <div class="px-6 max-w-[calc(100vw-16rem)]">
            <!-- Content header -->
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0 sm:space-x-4">
              <div>
                <h2 class="text-2xl font-semibold text-gray-900">Content Planning</h2>
                <p class="text-sm text-gray-500 mt-1">
                  Plan, track, and publish your content marketing strategy
                </p>
              </div>
              <div class="flex items-center space-x-3">
                <form id="propertyForm" method="POST" action="/contenthub" class="relative">
                  <select id="projects-ids" name="projects-ids" onchange="this.form.submit()" class="block w-64 px-4 h-9 text-sm border border-gray-300 rounded-lg shadow-sm bg-white hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 appearance-none">
                    {% for each_site in site_list %}
                    {% if each_site == selected_property %}
                    <option value="{{ each_site }}" selected>{{ each_site }}</option>
                    {% else %}
                    <option value="{{ each_site }}">{{ each_site }}</option>
                    {% endif %}
                    {% endfor %}
                  </select>
                  <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                    <i class="fas fa-chevron-down text-sm"></i>
                  </div>
                </form>
                <button class="inline-flex items-center px-4 h-9 text-sm font-medium border border-gray-300 rounded-lg shadow-sm bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                  <i data-feather="download" class="w-4 h-4 mr-2"></i>
                  Export
                </button>
                <button id = 'add-new-content-button' name = 'add-new-content-button' class="inline-flex items-center px-4 h-9 text-sm font-medium rounded-lg shadow-sm bg-purple-600 text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                  <i data-feather="plus-circle" class="w-4 h-4 mr-2"></i>
                  Add New
                </button>
              </div>
            </div>

            <!-- Filters -->
            <div class="my-6" id="filters-container">
              <div class="flex items-center justify-between">
                <!-- <button class="inline-flex items-center px-4 h-9 text-sm font-medium border border-gray-300 rounded-lg shadow-sm bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500" id="filters-toggle">
                  <i data-feather="filter" class="w-4 h-4 mr-2"></i>
                  Filters
                </button> -->
              </div>
            </div>

            <!-- Table -->
            <div class="mt-4 border border-gray-200 rounded-lg shadow-lg bg-white overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer group sticky top-0 bg-gray-50">
                        <div class="flex items-center space-x-1">
                          <span>Priority</span>
                          <i data-feather="arrow-up-down" class="w-4 h-4 text-gray-400 group-hover:text-gray-600"></i>
                        </div>
                      </th>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer group sticky top-0 bg-gray-50">
                        <div class="flex items-center space-x-1">
                          <span>Name</span>
                          <i data-feather="arrow-up-down" class="w-4 h-4 text-gray-400 group-hover:text-gray-600"></i>
                        </div>
                      </th>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50">Brief</th>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer group sticky top-0 bg-gray-50">Primary Keyword</th>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer group sticky top-0 bg-gray-50">Funnel Stage</th>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer group sticky top-0 bg-gray-50">Status</th>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50">Live URL</th>
                      <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50">Last Updated</th>
                      <th class="relative px-6 py-4 sticky top-0 bg-gray-50">
                        <span class="sr-only">Actions</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200" id="content-table-body">
                    <!-- Table content will be dynamically inserted here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Initialize Feather icons
    feather.replace();

    // Function to format date as "Mmm dd, yyyy"
    function formatDate(date) {
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
    }

    // Function to create new row form
    function createNewRowForm() {
      const today = new Date();
      const formattedDate = formatDate(today);
      
      // Create the form first
      const form = document.createElement('form');
      form.id = 'add_new_data';
      form.method = 'POST';
      form.action = '/add_new_content';
      form.style.display = 'none'; // Hide the form but keep it functional
      document.body.appendChild(form);
      
      const newRow = document.createElement('tr');
      newRow.className = 'bg-white animate-fadeIn';
      newRow.innerHTML = `
        <td class="px-6 py-4 whitespace-nowrap">
          <select name="PRIORITY" form="add_new_data" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="P1">P1</option>
            <option value="P2">P2</option>
            <option value="P3">P3</option>
          </select>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="NAME" form="add_new_data" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
        </td>
        <td class="px-6 py-4">
          <input type="text" name="BRIEF" form="add_new_data" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="PRIMARY_KEYWORD" form="add_new_data" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <select name="FUNNEL_STAGE" form="add_new_data" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="TOFU">TOFU</option>
            <option value="MOFU">MOFU</option>
            <option value="BOFU">BOFU</option>
          </select>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <select name="STATUS" form="add_new_data" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="Todo">Todo</option>
            <option value="In progress">In progress</option>
            <option value="Blocked">Blocked</option>
            <option value="Finished">Finished</option>
          </select>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="LIVE_URL" form="add_new_data" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="LAST_UPDATED" value="${formattedDate}" form="add_new_data" readonly class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md bg-gray-50">
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
          <button type="button" onclick="submitNewRow()" class="text-green-600 hover:text-green-900 mr-3">
            <i class="fas fa-save"></i>
          </button>
          <button type="button" onclick="cancelNewRow(this)" class="text-red-600 hover:text-red-900">
            <i class="fas fa-times"></i>
          </button>
        </td>
      `;
      
      // Insert the new row at the top of the table
      const tableBody = document.getElementById('content-table-body');
      tableBody.insertBefore(newRow, tableBody.firstChild);
    }

    // Function to submit the new row
    function submitNewRow() {
      const form = document.getElementById('add_new_data');
      if (form) {
        // Validate required fields
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            isValid = false;
            field.classList.add('border-red-500');
          } else {
            field.classList.remove('border-red-500');
          }
        });

        if (isValid) {
          // Ensure the date is set before submission
          const today = new Date();
          const formattedDate = formatDate(today);
          const lastUpdatedInput = form.querySelector('input[name="LAST_UPDATED"]');
          if (lastUpdatedInput) {
            lastUpdatedInput.value = formattedDate;
          }
          form.submit();
        } else {
          alert('Please fill in all required fields');
        }
      }
    }

    // Function to cancel new row
    function cancelNewRow(button) {
      const row = button.closest('tr');
      const form = document.getElementById('add_new_data');
      row.remove();
      if (form) {
        form.remove();
      }
    }

    // Add click event listener to Add New button
    document.getElementById('add-new-content-button').addEventListener('click', createNewRowForm);

    const getFunnelStageBadgeClasses = (stage) => {
      switch (stage) {
        case 'TOFU': return 'bg-blue-100 text-blue-800';
        case 'MOFU': return 'bg-purple-100 text-purple-800';
        case 'BOFU': return 'bg-green-100 text-green-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    };

    const getStatusBadgeClasses = (status) => {
      switch (status) {
        case 'Todo': return 'bg-gray-100 text-gray-800';
        case 'In progress': return 'bg-yellow-100 text-yellow-800';
        case 'Blocked': return 'bg-red-100 text-red-800';
        case 'Finished': return 'bg-green-100 text-green-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    };

    const getPriorityBadgeClasses = (priority) => {
      switch (priority) {
        case 'P1': return 'bg-red-100 text-red-800';
        case 'P2': return 'bg-green-100 text-green-800';
        case 'P3': return 'bg-orange-100 text-orange-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    };

    const renderTable = (items) => {
      const tableBody = document.getElementById('content-table-body');
      
      if (!items || items.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="9" class="px-6 py-8 text-center text-gray-500">
              <div class="flex flex-col items-center justify-center">
                <i data-feather="file-text" class="w-12 h-12 mb-3 text-gray-400"></i>
                <p class="text-lg font-medium">Add a data to Content hub</p>
              </div>
            </td>
          </tr>
        `;
        feather.replace();
        return;
      }

      tableBody.innerHTML = items.map(item => {
        // Ensure URL is treated as external by adding http:// if not present
        const liveUrl = item['LIVE_URL'] && item['LIVE_URL'].toLowerCase() !== 'not published' 
          ? (item['LIVE_URL'].startsWith('http://') || item['LIVE_URL'].startsWith('https://') 
              ? item['LIVE_URL'] 
              : `https://${item['LIVE_URL']}`)
          : null;

        return `
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${getPriorityBadgeClasses(item['PRIORITY'])}">
              ${item['PRIORITY']}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
            ${item['NAME']}
          </td>
          <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">
            ${item['BRIEF']}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${item['PRIMARY_KEYWORD']}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${getFunnelStageBadgeClasses(item['FUNNEL_STAGE'])}">
              ${item['FUNNEL_STAGE']}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${getStatusBadgeClasses(item['STATUS'])}">
              ${item['STATUS']}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${liveUrl ? 
              `<a href="${liveUrl}" target="_blank" rel="noopener noreferrer" class="text-purple-600 hover:text-purple-900 flex items-center group">
                <span class="mr-1">View</span>
                <i data-feather="external-link" class="w-4 h-4 transition-transform group-hover:translate-x-0.5"></i>
              </a>` : 
              '<span class="text-gray-400">Not published</span>'
            }
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${item['LAST_UPDATED'] || 'Not updated'}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <div class="flex space-x-3 justify-end">
              <button onclick="editContent('${item.id}')" class="text-purple-600 hover:text-purple-900 transition-colors">
                <i data-feather="edit" class="w-[18px] h-[18px]"></i>
              </button>
              <button onclick="deleteContent('${item.id}')" class="text-red-600 hover:text-red-900 transition-colors">
                <i data-feather="trash-2" class="w-[18px] h-[18px]"></i>
              </button>
            </div>
          </td>
        </tr>
      `}).join('');
      
      feather.replace();
    };

    // Function to handle edit action
    function editContent(id) {
      const row = event.target.closest('tr');
      const cells = row.cells;
      
      // Create the form first
      const form = document.createElement('form');
      form.id = 'edit_content_form';
      form.method = 'POST';
      form.action = '/update_content';
      form.style.display = 'none'; // Hide the form but keep it functional
      document.body.appendChild(form);

      // Add hidden input for ID
      const idInput = document.createElement('input');
      idInput.type = 'hidden';
      idInput.name = 'id';
      idInput.value = id;
      form.appendChild(idInput);
      
      // Store original row content for cancel
      row.dataset.originalContent = row.innerHTML;
      
      // Create editable row content
      row.innerHTML = `
        <td class="px-6 py-4 whitespace-nowrap">
          <select name="PRIORITY" form="edit_content_form" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="P1" ${cells[0].textContent.trim() === 'P1' ? 'selected' : ''}>P1</option>
            <option value="P2" ${cells[0].textContent.trim() === 'P2' ? 'selected' : ''}>P2</option>
            <option value="P3" ${cells[0].textContent.trim() === 'P3' ? 'selected' : ''}>P3</option>
          </select>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="NAME" form="edit_content_form" value="${cells[1].textContent.trim()}" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
        </td>
        <td class="px-6 py-4">
          <input type="text" name="BRIEF" form="edit_content_form" value="${cells[2].textContent.trim()}" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="PRIMARY_KEYWORD" form="edit_content_form" value="${cells[3].textContent.trim()}" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <select name="FUNNEL_STAGE" form="edit_content_form" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="TOFU" ${cells[4].textContent.trim() === 'TOFU' ? 'selected' : ''}>TOFU</option>
            <option value="MOFU" ${cells[4].textContent.trim() === 'MOFU' ? 'selected' : ''}>MOFU</option>
            <option value="BOFU" ${cells[4].textContent.trim() === 'BOFU' ? 'selected' : ''}>BOFU</option>
          </select>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <select name="STATUS" form="edit_content_form" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="Todo" ${cells[5].textContent.trim() === 'Todo' ? 'selected' : ''}>Todo</option>
            <option value="In progress" ${cells[5].textContent.trim() === 'In progress' ? 'selected' : ''}>In progress</option>
            <option value="Blocked" ${cells[5].textContent.trim() === 'Blocked' ? 'selected' : ''}>Blocked</option>
            <option value="Finished" ${cells[5].textContent.trim() === 'Finished' ? 'selected' : ''}>Finished</option>
          </select>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="LIVE_URL" form="edit_content_form" value="${cells[6].querySelector('a') ? cells[6].querySelector('a').href : ''}" class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" name="LAST_UPDATED" value="${formatDate(new Date())}" form="edit_content_form" readonly class="block w-full px-3 py-2 text-sm border border-gray-300 rounded-md bg-gray-50">
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
          <button type="button" onclick="submitEdit()" class="text-green-600 hover:text-green-900 mr-3">
            <i class="fas fa-save"></i>
          </button>
          <button type="button" onclick="cancelEdit(this)" class="text-red-600 hover:text-red-900">
            <i class="fas fa-times"></i>
          </button>
        </td>
      `;
    }

    // Function to submit the edited row
    function submitEdit() {
      const form = document.getElementById('edit_content_form');
      if (form) {
        // Validate required fields
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            isValid = false;
            field.classList.add('border-red-500');
          } else {
            field.classList.remove('border-red-500');
          }
        });

        if (isValid) {
          form.submit();
        } else {
          alert('Please fill in all required fields');
        }
      }
    }

    // Function to cancel edit
    function cancelEdit(button) {
      const row = button.closest('tr');
      const form = document.getElementById('edit_content_form');
      if (row.dataset.originalContent) {
        row.innerHTML = row.dataset.originalContent;
      }
      if (form) {
        form.remove();
      }
    }

    // Function to handle delete action
    function deleteContent(id) {
      if (confirm('Are you sure you want to delete this content?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/delete_content';
        
        const idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'id';
        idInput.value = id;
        
        form.appendChild(idInput);
        document.body.appendChild(form);
        form.submit();
      }
    }

    /*
    // Function to filter table rows based on selected filters
    function filterTable() {
      const selectedStatuses = Array.from(document.querySelectorAll('.filters-panel input[type="checkbox"]:checked'))
        .filter(checkbox => checkbox.closest('div').querySelector('h3').textContent.includes('Status'))
        .map(checkbox => checkbox.nextElementSibling.textContent.trim());

      const selectedStages = Array.from(document.querySelectorAll('.filters-panel input[type="checkbox"]:checked'))
        .filter(checkbox => checkbox.closest('div').querySelector('h3').textContent.includes('Funnel_Stage'))
        .map(checkbox => checkbox.nextElementSibling.textContent.trim());

      const rows = document.querySelectorAll('#content-table-body tr');
      
      rows.forEach(row => {
        const status = row.querySelector('td:nth-child(6) span').textContent.trim();
        const stage = row.querySelector('td:nth-child(5) span').textContent.trim();
        
        const statusMatch = selectedStatuses.length === 0 || selectedStatuses.includes(status);
        const stageMatch = selectedStages.length === 0 || selectedStages.includes(stage);
        
        row.style.display = statusMatch && stageMatch ? '' : 'none';
      });
    }

    // Function to reset filters
    function resetFilters() {
      // Uncheck all checkboxes
      document.querySelectorAll('.filters-panel input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // Show all rows
      document.querySelectorAll('#content-table-body tr').forEach(row => {
        row.style.display = '';
      });
    }
    */

    // Initial render with real data
    const contentHubData = JSON.parse('{{ content_hub_data|tojson|safe }}');
    renderTable(contentHubData);

    /*
    const filtersToggle = document.getElementById('filters-toggle');
    const filtersContainer = document.getElementById('filters-container');

    filtersToggle.addEventListener('click', () => {
      const filtersPanel = document.querySelector('.filters-panel');
      if (filtersPanel) {
        filtersPanel.remove();
      } else {
        const panel = document.createElement('div');
        panel.className = 'filters-panel mt-3 bg-white p-4 rounded-md shadow-sm border border-gray-200 animate-fadeIn';
        panel.innerHTML = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">Status</h3>
              <div class="space-y-2">
                ${['Todo', 'In progress', 'Blocked', 'Finished'].map(status => `
                  <label class="flex items-center">
                    <input type="checkbox" class="h-4 w-4 text-purple-600 rounded border-gray-300 focus:ring-purple-500">
                    <span class="ml-2 text-sm text-gray-700">${status}</span>
                  </label>
                `).join('')}
              </div>
            </div>
            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">Funnel Stage</h3>
              <div class="space-y-2">
                ${['TOFU', 'MOFU', 'BOFU'].map(stage => `
                  <label class="flex items-center">
                    <input type="checkbox" class="h-4 w-4 text-purple-600 rounded border-gray-300 focus:ring-purple-500">
                    <span class="ml-2 text-sm text-gray-700">${stage}</span>
                  </label>
                `).join('')}
              </div>
            </div>
          </div>
          <div class="mt-4 flex justify-end space-x-3">
            <button onclick="filterTable()" class="inline-flex items-center px-3 h-8 text-xs font-medium rounded-lg shadow-sm bg-purple-600 text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
              Apply Filters
            </button>
            <button onclick="resetFilters()" class="inline-flex items-center px-3 h-8 text-xs font-medium rounded-lg shadow-sm border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
              Reset
            </button>
          </div>
        `;
        filtersContainer.appendChild(panel);
      }
    });
    */
  </script>
</body>
</html>
